<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1" name="viewport" />
<meta content="unicode,utf-8,emoji" name="keywords" />
<meta content="Unicode Introduction" name="description" />
<title>Put some ink into the inkpot - 又一篇Unicode的入門介紹</title><link href="atom.xml" rel="alternate" title="Put some ink into the inkpot" type="application/atom+xml" /><link href="/css/output.css" rel="stylesheet" /><link href="/css/default.css" rel="stylesheet" /><link href="/css/table.css" rel="stylesheet" /><link href="/css/hightlight.css" rel="stylesheet" /></head><body class="text-base text-black"><header class="border-b-2 border-black"><div class="logo"><a href="/">Put some ink into the inkpot</a></div><nav class="text-right"><a class="text-black font-bold text-lg no-underline uppercase" href="/archive.html">Archive</a><a class="text-black font-bold text-lg no-underline uppercase" href="/logseq">Note</a><a class="text-black font-bold text-lg no-underline uppercase" href="/atom.xml">RSS</a></nav></header><main><div><article><h1>又一篇Unicode的入門介紹</h1><section class="header">
Posted on Jan 04, 2025
</section><section><div><div class="toc"><div class="header">Table of Contents</div><ul>
<li><a href="#unicode-簡介" id="toc-unicode-簡介"><span
class="toc-section-number">1</span> Unicode 簡介</a>
<ul>
<li><a href="#code-planes" id="toc-code-planes"><span
class="toc-section-number">1.1</span> Code planes</a></li>
</ul></li>
<li><a href="#encoding" id="toc-encoding"><span
class="toc-section-number">2</span> Encoding</a>
<ul>
<li><a href="#utf-32" id="toc-utf-32"><span
class="toc-section-number">2.1</span> UTF-32</a></li>
<li><a href="#utf-16" id="toc-utf-16"><span
class="toc-section-number">2.2</span> UTF-16</a></li>
<li><a href="#utf-8" id="toc-utf-8"><span
class="toc-section-number">2.3</span> UTF-8</a></li>
</ul></li>
<li><a href="#emoji" id="toc-emoji"><span
class="toc-section-number">3</span> Emoji</a>
<ul>
<li><a href="#skin-tone-modifier" id="toc-skin-tone-modifier"><span
class="toc-section-number">3.1</span> Skin tone modifier</a></li>
<li><a href="#zero-width-joiner-zwj"
id="toc-zero-width-joiner-zwj"><span
class="toc-section-number">3.2</span> Zero-width joiner (ZWJ)</a></li>
<li><a href="#變體選擇符vs-15-和-vs-16"
id="toc-變體選擇符vs-15-和-vs-16"><span
class="toc-section-number">3.3</span> 變體選擇符VS-15 和 VS-16</a></li>
<li><a href="#範例程式" id="toc-範例程式"><span
class="toc-section-number">3.4</span> 範例程式</a></li>
</ul></li>
<li><a href="#reference" id="toc-reference"><span
class="toc-section-number">4</span> Reference</a></li>
</ul></div><div><p>一直以來，我對於Unicode總是處於一知半解的情況，剛好最近在上<a
href="https://learning.edx.org/course/course-v1:HarvardX+CS50+X/home"
title="CS50">CS50</a>，在第0講就提到了如何用0，1編碼表達文字，也從ASCII講到了Unicode，我也趁這個機會從頭學習了Unicode，以下就是我從CS50還有其他網路資源學習到的內容。</p>
<h1 data-number="1" id="unicode-簡介"><span
class="header-section-number">1</span> Unicode 簡介</h1>
<p>Unicode的目標是提供一個文字編碼的方案，可以包含所有人類想要數位化的文字符號。</p>
<p>Unicode將每個<em>字</em>對應到一個Code point。Code point
可以簡單理解為一個數字，為了方便起見，慣例用16進位表示這個數字。例如😂
對應到的是U+1F602這個數字。</p>
<p>因為可包含的文字符號很多，Unicode把可以編碼的文字符號劃分為17個Code
Plane，每個 Plane 又包含了65536個Code Point。所以 Unicode
可以囊括的文字上限為 65536 * 17 =1,114,112 個文字。</p>
<h2 data-number="1.1" id="code-planes"><span
class="header-section-number">1.1</span> Code planes</h2>
<p>Plane 的編號從0到16，共17個。其中最重要的是<em>Plane
0</em>，也稱為<strong>BMP</strong> (Basic Multilingual
Plane)。大部分語言的常用字符，都包含在BMP裡面，常用的CJK文字也在BMP裡面。BMP的範圍是從0000到FFFF，也就是能用2個byte表示的範圍。</p>
<p>其他的Plane大致可稱為 Supplementary Planes，詳細的劃分可以參考<a
href="https://en.wikipedia.org/wiki/Plane_(Unicode)"
title="Plane (Unicode)">維基頁面</a>。</p>
<h3 data-number="1.1.1" id="bmps-surrogate-area"><span
class="header-section-number">1.1.1</span> BMP’s Surrogate area</h3>
<p>在BMP中有一塊範圍從 U+D800 到U+DFFF，這個範圍被稱為Surrogate area。
Surrogate area
是一塊保留區，不會有任何字符被指定到這個區域，它的主要功能是讓UTF-16
可以用這塊區域去編碼超過2byte 大小的code point。</p>
<p>Surrogate area 可以再分為High Surrogate 和 Low Surrogate。 High
Surrogate 的範圍是從 <code>U+D800</code> 到 <code>U+DBFF</code>，而 Low
Surrogate的範圍是從<code>U+DC00</code> 到 <code>U+DFFF</code> 。
不難看出, High Surrogate 和 Low Surrogate 的大小都是 4
<em> 256，所以當我們把 High Surrogate 和 Low Surrogate
組合起來的話，就可以得到4</em>256<em>4</em>256 種可能，等於
16*65536，也就是 Plane 1 到 Plane 16所需要的個數！</p>
<h1 data-number="2" id="encoding"><span
class="header-section-number">2</span> Encoding</h1>
<p>雖然我們定義了Code point，但Code point
只是一個數字，接下來，我們還需要編碼這個數字，讓電腦可以讀取。編碼的方法有很多種，也各自有優缺點，現在最常見的3種是UTF-32,
UTF-16, 和UTF-8。</p>
<h2 data-number="2.1" id="utf-32"><span
class="header-section-number">2.1</span> UTF-32</h2>
<p>UTF-32 簡單暴力，因為每個Unicode code point
其實只需要21個bit就可以表示出來，UTF-32直接用32個bit表示，多出來的11個bit就直接補0。</p>
<p>好處是有兩個，第一個好處是code point 和 binary number
直接對應，不需要額外的複雜encoding
規則。延伸出來的第二個好處就是UTF-32是一個固定長度的編碼，所以我們要找到某個字串的第N個字，假如字串是UTF-32編碼，就可以在常數時間找到，但要注意的是，現在的Unicode編碼有像Skin
tone modifier, Zero-width joiner
等修飾字符，所以這個常數時間定位，也未必能跟眼睛所見的、螢幕上顯示的字符做一對一的定位。</p>
<p>壞處也很顯而易見，就是空間的浪費，尤其我們之前提到，常用字都在BMP，只需要2
bytes 就可以表示，UTF-32卻一律都使用了4
bytes。另外一個問題是可能需要BOM(Byte Order
Mark)，來確定位元順序是little-endian 還是 big-endian。
因為空間的浪費，所以UTF-32在實務上比起UTF-16，UTF-8來說很少使用。</p>
<p>另外，在有些文獻可能會提到UCF-4這個詞，簡單來說UTF-32跟UCF-4是一樣的東西，只是名稱上的差異。</p>
<h2 data-number="2.2" id="utf-16"><span
class="header-section-number">2.2</span> UTF-16</h2>
<p>UTF-16 用兩個byte編碼BMP，對於其他plane，則用上述提到過的Surrogate
area來編碼，也就是說，在BMP之內的字符，會是2個bytes長，BMP之外的字符，則會是4個bytes
長。</p>
<p>好處是常用字符(BMP)都只需要2個bytes，節省空間。壞處是不兼容ASCII,
原先用ASCII表示的話，只需要1 byte 的英文字母，用UTF-16則需要2 bytes。
另外也需要 BMP 來確定位元順序。</p>
<p>在有些地方可以看到USC-2這個詞，可以把USC-2編碼視為不支持Surrogate
area的UTF-16,也就是說，USC-2 只會有2 bytes而且只能處理BMP有的字符。</p>
<h2 data-number="2.3" id="utf-8"><span
class="header-section-number">2.3</span> UTF-8</h2>
<p>UTF-8 的特色就是相容<a
href="https://zh.wikipedia.org/zh-tw/ASCII">ASCII</a>，所以只需要1
byte就能表示英文字母，對於相容只支援ASCII的舊系統也相當方便。
另外，UTF-8在設計上不需要BOM。缺點是對CJK的編碼需要3 bytes。</p>
<h3 data-number="2.3.1" id="編碼規則"><span
class="header-section-number">2.3.1</span> 編碼規則</h3>
<p>1 byte的情況：1 byte 完全相容 ASCII，為 <code>0xxxxxxx</code>
格式，只要byte的第1個 bit 是 0, 就一定是 ASCII。</p>
<p>多個bytes 的情況:
第一個byte的開始有連續幾個1，就是代表這組總共有幾個bytes。 且第一個 byte
之後同一組的byte，都會是 <code>10xxxxxx </code> 格式。</p>
<ul>
<li>2 bytes: <code>110xxxxx 10xxxxxx</code></li>
<li>3 bytes: <code>1110xxxx 10xxxxxx 10xxxxxx</code></li>
<li>4 bytes: <code>11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</code></li>
</ul>
<p>簡單算一下，2 bytes 可以包含 2^11 =2,048 個 code points。 3 bytes
可以包含 2^16=65,536 個 code points (1 個 plane 的大小) 4 bytes 可以包含
2^21=2,097,152 個 code points (整個 unicode 的大小)</p>
<h3 data-number="2.3.2" id="mysql-的故事"><span
class="header-section-number">2.3.2</span> MySQL 的故事</h3>
<p>MySQL 裡面有 utfmb3 編碼跟 utfmb4 編碼，基本上utfmb3
是一個實作上的錯誤，它雖然是utf-8編碼卻最多只能有3個byte，無法正確存放所有Unicode。也因此，在使用
Mysql 的utf 編碼時，務必要使用utfmb4 編碼。</p>
<h1 data-number="3" id="emoji"><span
class="header-section-number">3</span> Emoji</h1>
<p>Unicode也包含了大家喜歡的表情符號emoji，例如😂😭等等，是在網路上與人交流不可或缺的工具。因為emoji太好用了，所以大家就想加越來越多的emoji到Unicode裡，像是各種膚色的emoji
👍
👍🏻，或是帶著筆電的男人👨🏽‍💻，或是有著紅頭髮的女人👩🏻‍🦰……等等。這些emoji的膚色或攜帶物品或髮型，可以有各種組合，假如每個組合都是一個獨立的emoji，那我們的Unicode就不夠用了，為了避免這個問題，我們就有了Skin
tone modifier, ZWJ 等特殊字元，來解決emoji的組合問題。</p>
<h2 data-number="3.1" id="skin-tone-modifier"><span
class="header-section-number">3.1</span> Skin tone modifier</h2>
<p>Skin tone modifier
總共有5個，它可以改變emoji的膚色，總共有5個，分別是</p>
<ul>
<li><code>U+1F3FB</code> 🏻</li>
<li><code>U+1F3FC</code> 🏼</li>
<li><code>U+1F3FD</code> 🏽</li>
<li><code>U+1F3FE</code> 🏾</li>
<li><code>U+1F3FF</code> 🏿</li>
</ul>
<p>把它加在原來emoji的後面，就可以改變emoji的膚色。例如
<code>U+1F44D</code> 是預設黃色的👍，<code>U+1F44D U+1F3FB</code>
就會變成淺皮膚色的👍🏻。</p>
<h2 data-number="3.2" id="zero-width-joiner-zwj"><span
class="header-section-number">3.2</span> Zero-width joiner (ZWJ)</h2>
<p>ZWJ(<code>U+200D</code>)可以結合多個emoji而產生出一個新的emoji，利用ZWJ，我們可以用原有的emoji為基礎，而定義出新的emoji。例如當我們想要有一個emoji是紅頭髮的淺皮膚女性，就可以有以下Unicode順序：<code>U+1F469 U+1F3FB U+200D U+1F9B0 </code></p>
<ul>
<li><code>U+1F469 U+1F3FB </code>: 👩🏻</li>
<li><code>U+200D</code>: ZWJ</li>
<li><code>U+1F9B0</code>: 🦰</li>
</ul>
<p>所以合起來就會得到： 👩🏻‍🦰</p>
<h2 data-number="3.3" id="變體選擇符vs-15-和-vs-16"><span
class="header-section-number">3.3</span> 變體選擇符VS-15 和 VS-16</h2>
<p>在Unicode中有所謂的變體選擇符(Variation Selector)，其中的VS-15
(<code>U+FE0E</code>)和VS-16(<code>U+FE0F</code>)是專屬於emoji使用的。
VS-15表示要用單色的方式顯示emoji，VS-16則表示要用彩色的方式來顯示emoji。以下是一個例子：(不同平台呈現的效果可能不同)</p>
<ul>
<li>☕ (<code>U+2615</code>)</li>
<li>☕︎ (<code>U+2615 U+FE0E</code>)</li>
<li>☕️ (<code>U+2615 U+FE0F</code>)</li>
</ul>
<h2 data-number="3.4" id="範例程式"><span
class="header-section-number">3.4</span> 範例程式</h2>
<p>寫了一個簡單程式，可以demo上面的例子，大家也可以自行修改來玩玩，只要裝<a
href="https://babashka.org/">Babashka</a> 就可以執行了。</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> light-skin </span><span class="bn">0x1F3FB</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> medium-light-skin </span><span class="bn">0x1F3FC</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> medium-skin </span><span class="bn">0x1F3FD</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> medium-dark-skin </span><span class="bn">0x1F3FE</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> dark-skin </span><span class="bn">0x1F3FF</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> thumb </span><span class="bn">0x1F44D</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> thumb-light-skin </span>[thumb light-skin])</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> man-with-computer </span>[<span class="bn">0x1F468</span> <span class="bn">0x1F3FD</span> <span class="bn">0x200D</span> <span class="bn">0x1F4BB</span>])</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> woman-with-light-skin </span>[<span class="bn">0x1F469</span> <span class="bn">0x1F3FB</span>])</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> woman-with-redhair </span>[<span class="bn">0x1F469</span> <span class="bn">0x1F3FB</span> <span class="bn">0x200D</span> <span class="bn">0x1F9B0</span>])</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> coffee </span><span class="bn">0x2615</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> merge-to-chars </span>[code-points]</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [char-arrays (<span class="kw">map</span> #(Character/toChars <span class="va">%</span>) code-points)]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    (String. (<span class="kw">char-array</span> (<span class="kw">apply</span> <span class="kw">concat</span> char-arrays)))))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> show </span>[&amp; code-point-groups]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">doseq</span> [group code-point-groups]</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">print</span> (merge-to-chars group)))</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">println</span>))</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>(show [thumb] thumb-light-skin)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>(show man-with-computer woman-with-light-skin woman-with-redhair)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>(show [light-skin medium-light-skin medium-skin medium-dark-skin dark-skin])</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>(show [coffee] [coffee <span class="bn">0xFE0E</span>] [coffee <span class="bn">0xFE0F</span>])</span></code></pre></div>
<h1 data-number="4" id="reference"><span
class="header-section-number">4</span> Reference</h1>
<ol type="1">
<li><a
href="https://medium.com/@angus258963/%E5%BE%9Eunicode%E5%88%B0emoji-8cab765f55d9">從
Unicode 到 Emoji </a></li>
</ol></div></div></section></article><comment><script async="async" crossorigin="anonymous" data-category-id="DIC_kwDOD5Bpa84COAIg" data-category="General" data-emit-metadata="0" data-input-position="top" data-lang="en" data-mapping="pathname" data-reactions-enabled="0" data-repo-id="MDEwOlJlcG9zaXRvcnkyNjExMjI0MTE=" data-repo="onemouth/onemouth.github.io" data-theme="light" src="https://giscus.app/client.js"></script><script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script></comment></div></main><footer class="mt-12 py-3 border-t-2 border-black text-sm text-gray-500">Site generated by pandoc and babashka</footer></body></html>
